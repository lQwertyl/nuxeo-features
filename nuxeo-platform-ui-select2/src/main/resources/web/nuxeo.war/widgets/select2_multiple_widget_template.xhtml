<c:if test="true" xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:nxd="http://nuxeo.org/nxweb/document"
  xmlns:nxl="http://nuxeo.org/nxforms/layout"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:a4j="https://ajax4jsf.dev.java.net/ajax">

  <c:set var="namespace" value="#{widgetProperty_namespace}" />

  <nxu:set var="helpLabel"
    value="#{nxu:test(empty widgetProperty_helpLabel, messages['label.suggestion.help.minChars'], nxu:test(widget.translated, messages[widgetProperty_helpLabel], widgetProperty_helpLabel))}"
    cache="true">

    <c:choose>

      <c:when
        test="#{nxl:isLikePlainMode(widget.mode) or widget.mode == 'pdf'}">
        <c:forEach var="label"
          items="#{select2Actions.resolveMultipleReferenceLabels(field_0, widgetProperty_repository,widgetProperty_initOperationId, widgetProperty_idProperty,widgetProperty_labelProperty)}">
          <h:outputText value="#{label}" />
          <br />
        </c:forEach>
      </c:when>

      <c:otherwise>
        <ui:include src="/incl/select2_js.xhtml" />

        <a4j:region>
          <nxu:valueHolder id="#{widget.id}_select2" value="#{field_0}"
            immediate="true" ajaxSingle="true"
            required="#{widgetProperty_required}" var="currentValue">
            <f:converter converterId="select2Converter"></f:converter>
            <h:inputHidden readonly="true"
              id="#{widget.id}_select2_init"
              value="#{select2Actions.resolveMultipleReferences(currentValue, widgetProperty_repository,widgetProperty_initOperationId, widgetProperty_idProperty, widgetProperty_documentSchemas)}" />
          </nxu:valueHolder>

          <c:if test="#{not empty widgetProperty_ajaxReRender}">
            <a4j:jsFunction name="#{widget.id}_reRender"
              reRender="#{widgetProperty_ajaxReRender}" />
          </c:if>

        </a4j:region>

        <c:if
          test="#{widget.mode == 'edit' and !widgetProperty_hideHelpLabel}">
          <p class="detail">
            <h:outputFormat value="#{helpLabel}">
              <f:param value="#{widgetProperty_minChars}" />
            </h:outputFormat>
          </p>
        </c:if>

        <h:inputHidden readonly="true" id="#{widget.id}_select2_params"
          value="#{select2Actions.encodeParameters(widget)}" />
        <h:message for="#{widget.id}_select2" styleClass="errorMessage" />
      </c:otherwise>

    </c:choose>

  </nxu:set>

</c:if>